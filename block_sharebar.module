<?php

/**
 * Implements hook_init().
 */
function block_sharebar_init() {

    drupal_add_css(drupal_get_path('module', 'block_sharebar') . '/css/block-sharebar.css');

}
/**
 * Implements hook_block_info().
 *
 * This hook declares what blocks are provided by the module.
 */
function block_sharebar_block_info() {
  // This hook returns an array, each component of which is an array of block
  // information. The array keys are the 'delta' values used in other block
  // hooks.
  // Many options are defined in hook_block_info():
  $blocks['block_sharebar_configurable_text'] = array(
    // info: The name of the block.
    'info' => t('Block Sharebar'),
    // Block caching options (per role, per user, etc.)
    // DRUPAL_CACHE_PER_ROLE is the default.
    'cache' => DRUPAL_CACHE_PER_ROLE,
  );

  return $blocks;
}

/**
 * Implements hook_block_view().
 *
 * This hook generates the contents of the blocks themselves.
 */
function block_sharebar_block_view($delta = '') {
  // The $delta parameter tells us which block is being requested.
  switch ($delta) {
    case 'block_sharebar_configurable_text':
      // The subject is displayed at the top of the block. Note that it
      // should be passed through t() for translation. The title configured
      // for the block using Drupal UI supercedes this one.
      $block['subject'] = t('Blcok Sharebar');
      // The content of the block is typically generated by calling a custom
      // function.
      $block['content'] = block_sharebar_contents($delta);
      break;
  }
  return $block;
}

/**
 * A module-defined block content function.
 */
function block_sharebar_contents($which_block) {
  switch ($which_block) {
    case 'block_sharebar_configurable_text':
        $cls = 'block-sharebar';
        $str = '<div id="' . $cls . '">';
        $buttons = unserialize(variable_get('sharebar_buttons', sharebar_buttons_def()));
        if (is_array($buttons) && count($buttons)) {
          usort($buttons, "sharebar_cmp_up");
          foreach ($buttons as $key => $value) {
            if ($value->enabled) {
              $str .= '<div class="'. $value->name .'">' . sharebar_bar_filter($value->small_button, drupal_get_title()) . '</div>';
            }
          }
        }
        $str .= '</div>';
      return $str;
  }
}

